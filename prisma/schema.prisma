generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AppType {
  public
  confidential
}

model app {
  id            String                @id(map: "app_pkey") @default(cuid())
  created_at    DateTime              @default(now()) @db.Timestamptz(6)
  name          String
  logo          String
  type          AppType               @default(public)
  client_id     String                @unique
  client_secret String                @unique
  redirect_uris String[]
  scope         String[]
  owner         String
  user          user                  @relation(fields: [owner], references: [id], onDelete: NoAction, onUpdate: NoAction)
  authorized_by user_authorized_app[]
}

model user {
  id              String                @id(map: "user_pkey") @default(cuid())
  created_at      DateTime              @default(now()) @db.Timestamptz(6)
  email           String                @unique
  name            String?
  avatar          String
  apps            app[]
  authorized_apps user_authorized_app[]
}

model user_authorized_app {
  app_id     String
  app        app      @relation(fields: [app_id], references: [id])
  user_id    String
  user       user     @relation(fields: [user_id], references: [id])
  created_at DateTime @default(now())

  @@id([app_id, user_id])
}
